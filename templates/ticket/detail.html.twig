{% extends 'base.html.twig' %}

{% block title %}{{ticket.getTitle()}}{% endblock %}

{% block body %}
    <div class="d-flex flex-column">
        {% if is_granted('ROLE_ADMINISTRATOR') %}
            <a href="{{ path('ticket-delete', {slug: ticket.getSlug()}) }}" class="btn btn-danger my-3" tabindex="-1" role="button">Supprimer le ticket</a>
        {% endif %}
        {% if ticket.getIsClose() == false and (is_granted('ROLE_ADMINISTRATOR') or ticket.getAuthor().getId() == user.getId()) %}
            <a href="{{ path('ticket-close', {slug: ticket.getSlug()}) }}" class="btn btn-warning mb-3" tabindex="-1" role="button">Clôturer le ticket</a>            
        {% endif %}
        <h3 class="mt-3 mb-0">{{ticket.getTitle()}} - <i>{{ticket.getAuthor().getFullName()}}</i>{% if ticket.getIsClose() %}  <span class="badge bg-primary">Clôturé</span>{% endif %}</h3>
        <small>{{ticket.getCategory().getTitle()}}</small>
        <p class="my-3">{{ticket.getContent()}}</p>
        <h4>Les commentaires :</h4>
        {% for ticketComment in ticket.getTicketComments %}
            {% if ticketComment.getIsDelete() == false %}
                <div class="d-flex flex-column my-2 border-bottom pb-2">
                    <p>{{ticketComment.getContent()}}</p>
                    <small class="align-self-end fw-bold">{{ticketComment.getAuthor().getFullName()}}</small>
                    {% if is_granted('ROLE_ADMINISTRATOR') %}
                    <div class="align-self-end">
                        <a href="{{ path('ticketComment-delete', {id: ticketComment.getId()}) }}" class="btn btn-danger my-3" tabindex="-1" role="button">Supprimer le commentaire</a>
                    </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}
